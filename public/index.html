<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>ADB 远程画面与点击</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <aside class="sidebar">
      <h1>ADB 远程画面与点击</h1>
      <p>本页面通过 ADB 实时拉取手机截图，并支持点击画面进行远程点击。</p>
      <div class="status" id="status">未连接</div>
      <div class="card">
        <div class="card-title">主题</div>
        <div class="top-actions">
          <button id="themeToggleBtn" class="btn">切换浅色</button>
        </div>
      </div>
      <div class="card">
        <div class="card-title">录制与回放</div>
        <div class="controls">
          <button id="recordBtn" class="btn">开始录制</button>
          <button id="pauseBtn" class="btn" disabled>暂停录制</button>
          <button id="playBtn" class="btn">回放</button>
          <button id="saveBtn" class="btn">保存 JSON</button>
          <label class="btn file-btn" for="loadInput">读取 JSON</label>
          <input id="loadInput" type="file" accept="application/json" />
        </div>
      </div>
      <div class="card">
        <div class="card-title">定时任务</div>
        <div class="schedule">
          <div class="schedule-grid">
            <label>
              开始时间(24小时制，含毫秒)
              <input id="timeInput" type="time" step="0.001" value="" />
            </label>
            <label>
              间隔(ms)
              <input id="intervalInput" type="number" min="0" value="1000" />
            </label>
            <label>
              循环次数(0=无限)
              <input id="loopInput" type="number" min="0" value="1" />
            </label>
          </div>
          <div class="schedule-actions">
            <button id="scheduleBtn" class="btn">开始定时</button>
            <button id="stopScheduleBtn" class="btn" disabled>停止定时</button>
          </div>
        </div>
      </div>
      
      <div class="hint">提示：若画面卡顿，可调大采集间隔。</div>
    </aside>
    <main class="main">
      <canvas id="screen"></canvas>
      <div id="cursorInfo" class="cursor-info" aria-hidden="true"></div>
    </main>
    <aside class="rightbar" id="logPanel">
      <div class="drag-handle" id="logHandle" title="拖拽调整宽度"></div>
      <div class="card events-card">
        <div class="card-title">操作列表</div>
        <div class="event-controls">
          <button id="openAddModalBtn" class="btn">添加操作</button>
        </div>
        <div class="list" id="eventList">
          <div class="empty">暂无操作记录</div>
        </div>
      </div>

      <!-- 添加操作 Modal -->
      <div id="addModal" class="modal" aria-hidden="true">
        <div class="modal-backdrop"></div>
        <div class="modal-content">
          <h3>添加操作</h3>
          <div class="modal-row">
            <label>类型
              <select id="addType">
                <option value="tap">TAP</option>
                <option value="swipe">SWIPE</option>
                <option value="longpress">LONGPRESS</option>
                <option value="label">标签</option>
                <option value="goto">Goto</option>
                <option value="wait">延时 (Wait)</option>
              </select>
            </label>
          </div>
          <div class="modal-row">
            <div class="modal-group" data-for="tap,swipe,longpress">
              <label>X1 <input id="addX" type="number" value="0" /></label>
              <label>Y1 <input id="addY" type="number" value="0" /></label>
            </div>
          </div>
          <div class="modal-row">
            <div class="modal-group" data-for="swipe">
              <label>X2 <input id="addX2" type="number" value="0" /></label>
              <label>Y2 <input id="addY2" type="number" value="0" /></label>
            </div>
          </div>
          <div class="modal-row">
            <div class="modal-group" data-for="swipe,longpress">
              <label>时长(s) <input id="addDuration" type="number" step="0.01" value="0.30" /></label>
            </div>
          </div>
          <div class="modal-row">
            <div class="modal-group" data-for="label,goto">
              <label>标签名 <input id="addLabelName" type="text" value="" /></label>
            </div>
          </div>
          <div class="modal-row">
            <div class="modal-group" data-for="wait">
              <label>时长(s) <input id="addWaitDuration" type="number" step="0.1" value="1.0" /></label>
            </div>
          </div>
          <div class="modal-row">
            <div class="modal-group" data-for="goto">
              <label>条件
                <select id="addCondType">
                  <option value="none">无</option>
                  <option value="repeat">执行 n 次</option>
                  <option value="color">屏幕模糊取色</option>
                </select>
              </label>
            </div>
          </div>
          <div class="modal-row">
            <div class="modal-group" data-for="goto">
              <label class="cond-repeat" style="display:none">次数
                <input id="addCondTimes" type="number" min="1" value="1" />
              </label>
              <label class="cond-color" style="display:none">颜色
                <div class="color-picker-row">
                  <div id="addCondColorPreview" class="color-preview"></div>
                  <input id="addCondColor" type="text" placeholder="#rrggbb" />
                  <button id="addCondPickBtn" class="btn">取色</button>
                </div>
                <label>容差
                  <input id="addCondTol" type="number" min="0" value="30" />
                </label>
                <label>采样半径
                  <input id="addCondRadius" type="number" min="0" value="2" />
                </label>
                <label>采样坐标
                  <input id="addCondX" type="number" placeholder="x" />
                  <input id="addCondY" type="number" placeholder="y" />
                  <div class="small">提示：可手动填写或使用“取色”在画面上点击采样。</div>
                </label>
              </label>
            </div>
          </div>
          <input id="editIndex" type="hidden" value="-1" />
          <div class="modal-actions">
            <button id="addEventBtn" class="btn">添加</button>
            <button id="closeAddModalBtn" class="btn btn-ghost">取消</button>
          </div>
        </div>
      </div>
      <div class="card log-card">
        <div class="card-header">
          <div class="card-title">执行日志</div>
        </div>
        <div class="list" id="logList">
          <div class="empty">暂无执行日志</div>
        </div>
      </div>
    </aside>
    <script src="client.js"></script>
  </body>
</html>
